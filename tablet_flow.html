<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HyperVerge KYC</title>
    <script src="https://hv-camera-web-sg.s3-ap-southeast-1.amazonaws.com/hyperverge-web-sdk@test/src/sdk.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f5f5f5;
        }
        .container {
            margin-top: 50px;
        }
        .status-card {
            width: 80%;
            max-width: 400px;
            margin: 20px auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
        }
        .logo {
            width: 300px;
            height: auto;
        }
        .icon {
            width: 100px;
            height: 100px;
            margin-top: 20px;
        }
        .status-text {
            font-size: 20px;
            font-weight: bold;
        }
        .welcome-text {
            font-size: 18px;
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <div class="container">
        <img src="logo.png" class="logo" alt="Logo">
        <div id="status-card" class="status-card">
            <p class="status-text">Starting KYC...</p>
        </div>
    </div>

    <script>
        function getTransactionId() {
            const now = new Date();
            const monthName = now.toLocaleString('default', { month: 'long' });
            const day = now.getDate();
            const uniqueId = Math.random().toString(36).substring(7);
            return `HV_Enrol_${monthName}_${day}_${uniqueId}`;
        }

        function updateStatusCard(customerId, isSuccess, declineReason) {
            const statusCard = document.getElementById("status-card");
            statusCard.innerHTML = `
                <p class="status-text">Hello! ðŸ‘‹ ${customerId}</p>
                <p class="status-text">${isSuccess ? "Face Enrolled!" : "Face Enrol Failed"}</p>
                <img src="${isSuccess ? 'happy.png' : 'sad.png'}" class="icon">
                <p class="welcome-text">${isSuccess ? "Have a great day!" : "Decline Reason: " + declineReason}</p>
            `;
        }

        function startKYC() {
            console.log("Launching KYC...");

            const accessToken = "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhcHBJZCI6IjlyZGNyYyIsImhhc2giOiI5NDEyODQ1Y2UzZGNjZjcyM2E3ODI1YmMxYzhmYjhiYTY0NzM3NTQxZDI5MmE3MmYwODFiZjhkZTI0MWMzYTM5IiwiaWF0IjoxNzQyNTUyNjE2LCJleHAiOjE3NDI1OTU4MTYsImp0aSI6IjcwNTJmNWNkLTBiN2QtNDdmYy04MmZmLTA2OGFmNjQ2ZjFkYiJ9.Sqnz7QdSWpKpvnFhI7_aICcuFCWSHT2gHKO8Ad3X5eaVVzECD_fP2NQK6uWLX4boYy0facrx1bUA_2dhzS7DcEtJVASD97fwJ8_d27lFMm2z4p2hWfbiypY1XsBkTYW4K98RfSWntIq-Mmxoot78fII1El0RB-IpmKT2YCiNmBo";
            const hyperKycConfig = new HyperKycConfig(accessToken, "tablet_selfie", getTransactionId());

            const handler = (HyperKycResult) => {
                console.log("HyperKycResult", HyperKycResult);

                let customerId = HyperKycResult.details?.customerId || "Unknown";
                let declineReason = HyperKycResult.details?.declineReason || "No reason provided";
                let applicationStatus = HyperKycResult.status || "Unknown";
                let isSuccess = applicationStatus === "auto_approved";

                updateStatusCard(customerId, isSuccess, declineReason);

                // Retry indefinitely if KYC fails
                if (isSuccess!='') {
                    console.log("KYC completed successfully!");
                    console.log("Application Status:", applicationStatus);
                    console.log("Customer ID:", customerId);
                    console.log("Decline Reason:", declineReason);
                    setTimeout(startKYC, 3000);
                }
            };

            HyperKYCModule.launch(hyperKycConfig, handler);
        }
        
        window.onload = function () {
            window.HyperKYCModule.prefetch("9rdcrc", "tablet_selfie");
    
            startKYC();

        };
    </script>

</body>
</html>
